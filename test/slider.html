<html>
<body>
<head>
  <link rel="stylesheet" type="text/css" href="slider.css" />
</head>
<div class="picker" id="picker1"> 
    <div id="block"></div> 
</div>

<script type="text/javascript">
/*on définit les positions minimales et maximales en pixel sur laquelle pourra se déplacer le curseur dans l’axe du slider*/
var slider = document.getElementById("picker1")
var cursor = document.getElementById("block")

/*on définit les positions minimales et maximales en pixel sur laquelle pourra se déplacer le curseur dans l’axe du slider*/
var minX = -2; 
var maxX = slider.scrollWidth - cursor.scrollWidth;

/*valeur à soustraire*/
var offsetLeft = document.querySelector("#picker1").offsetLeft; 

/*on définit enfin la fonction slide, qui prend en paramètre un évènement touch et qui calcule la positon du doigt pour déplacer le curseur*/
function slide(touch) { 
    var pageX = touch.pageX - offsetLeft;
    left = pageX - (cursorWidth / 2) + minX;
    cursor.style.left = left+"px"; 
    var bgleft = left - minX;
    slider.style.backgroundPosition = bgleft + "px 0"; 
}

/*on abonne l’évènement touchmove du slider à cette méthode, et on lui passe le premier élément du tableau touches fourni par l’event. (Un event touch passe un tableau d’élément touch correspondant chacun à un doigt détecté)*/
slider.addEventListener('touchmove', function (event) { 
    event.preventDefault(); 
    slide(event.touches[0]); 
}, false);

/*La méthode va simplement peupler une liste de steps (stepsTab) et associer une valeur à des coordonnées.*/

            function SetSteps(min, max, step) { 
                var nbsteps = Math.floor(((max - min) / step)); 
                stepWidth = (maxX - minX) / nbsteps; 
                var stepsTab = []; 
                for (var i = 0; i < nbsteps; i++) {                  
                    stepsTab.push({ 
                        posx: minX + i * stepWidth, 
                        value: min + i*step 
                    }) 
                } 
                stepsTab.push({ 
                    posx: maxX, 
                    value: max 
                }) 
                return stepsTab; 
            } 

/*Pour pouvoir facilement associer la position de notre curseur à une valeur, il suffit de définir une fonction, qui prend en paramètre la position du curseur et renvoi le points le plus proche de ce dernier:*/
function GetClosestStep(posX) { 
    var halfStep = stepWidth / 2; 
    for (var i = 0; i < steps.length; i++) { 
        if (posX<steps\[i\].posx+halfStep) { 
            return steps\[i\]; 
        } 
    } 
}

/*Maintenant que l’on est capable de savoir quel est le point le plus proche de notre curseur à partir de sa position, il reste à créer la méthode qui va nous permettre de déplacer le curseur sur la position exacte du point le plus proche quand l’utilisateur décollera son doigt du curseur.*/
function toggle(step) { 
    var leftpos = step.posx; 
    cursor.style.left = leftpos+"px"; 
    slider.style.backgroundPosition = leftpos+"px 0"; 
    pickerValue = step.value; 
} 

/*Enfin, pour que le curseur soit effectivement attiré vers le point d’ancrage le plus proche à chaque fois que l’utilisateur fini un déplacement, on abonne l’évènement ontouchend du slider à la méthode toogle:*/
slider.addEventListener('touchend', function (event) { 
                event.preventDefault(); 
                toggle(GetClosestStep(left)); 
          }, false);
</script>
</body>
</html>